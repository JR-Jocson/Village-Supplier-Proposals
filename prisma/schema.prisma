// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  // Note: directUrl removed - using db push for schema changes when migrations can't connect
  // For migrations, use: npx prisma db push (works with DATABASE_URL)
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String   // Hashed password
  name      String
  role      String   @default("user") // user, admin
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Project {
  id              String       @id @default(uuid())
  kibbutzName     String       // Name of the kibbutz/settlement
  projectName     String       // Name of the project as written in Local Committee Approval
  submitterName   String       // Name of the person who submitted
  submitterEmail  String       // Email of the submitter
  submitterPhone  String       // Phone number of the submitter
  invoicePrice    Float?       // Detected price from invoice
  additionalNotes String?      // Additional notes from submitter (up to 1000 chars)
  status          String       @default("draft") // draft, submitted, reviewed, etc.
  laApproval      Boolean?     // Whether LA approval was received for the project
  avivaApproval   Boolean?     // Whether Aviva's approval for a public building was received
  files           ProjectFile[]
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt
}

model ProjectFile {
  id          String   @id @default(uuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  fileName    String   // Original file name
  filePath    String   // Path in Supabase Storage bucket
  fileType    String   // invoice, proposal, tender, committee_approval, charge_notice
  fileSize    Int      // File size in bytes
  mimeType    String   // MIME type (e.g., application/pdf)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([projectId])
}

